<div class="container-fluid">
    <h2 class="mt-4 mb-3">市场端功能</h2>

    <!-- 智能用户画像 -->
    <div class="card">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fa fa-users me-2"></i>智能用户画像</h5>
            <span class="status-badge status-success">运行中</span>
        </div>
        <div class="card-body">
            <p>整合淘宝/拼多多购买记录、抖音/快手互动数据、微信浏览行为，生成动态用户标签，并通过API输出至推广平台。</p>
            
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="user-segmentation-tab" data-bs-toggle="tab" data-bs-target="#user-segmentation" type="button" role="tab" aria-controls="user-segmentation" aria-selected="true">用户分群</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="behavior-analysis-tab" data-bs-toggle="tab" data-bs-target="#behavior-analysis" type="button" role="tab" aria-controls="behavior-analysis" aria-selected="false">行为分析</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="personalized-recommendation-tab" data-bs-toggle="tab" data-bs-target="#personalized-recommendation" type="button" role="tab" aria-controls="personalized-recommendation" aria-selected="false">个性化推荐</button>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content pt-3">
                <div class="tab-pane active" id="user-segmentation" role="tabpanel" aria-labelledby="user-segmentation-tab">
                    <h4>用户分群</h4>
                    <p class="text-muted">基于RFM模型和退货行为，识别高退货客户（占退货30%）和高价值客户（贡献30%销售额）。</p>
                    
                    <!-- 功能实现细化 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light" data-bs-toggle="collapse" href="#collapse-user-grouping" role="button" aria-expanded="false" aria-controls="collapse-user-grouping">
                            <h6 class="mb-0 d-flex justify-content-between">
                                <span><i class="fa fa-cogs me-2"></i>功能实现细化</span>
                                <i class="fa fa-chevron-down toggle-icon"></i>
                            </h6>
                        </div>
                        <div class="collapse" id="collapse-user-grouping">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>1. 数据收集与整合:</strong>
                                        <p class="mb-1 small text-muted">从淘宝、拼多多API获取用户购买记录；通过爬虫抓取抖音、快手用户的公开互动数据（点赞、评论）；通过SDK采集微信小程序内的浏览行为。数据进入Kafka消息队列进行缓冲。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>2. 特征构建 (ETL):</strong>
                                        <p class="mb-1 small text-muted">使用Spark Streaming实时处理Kafka数据流，进行数据清洗、去重和格式统一。计算RFM（最近购买时间、购买频率、购买金额）指标，并结合退货记录，为每个用户生成初步特征集，存入数据仓库（如ClickHouse）。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>3. 用户分群模型:</strong>
                                        <p class="mb-1 small text-muted">每日定时任务触发XGBoost或K-Means聚类模型，对特征数据进行训练和预测。根据业务规则（如退货率>30%或贡献销售额>30%）对聚类结果进行微调，最终生成“高价值客户”、“高退货风险客户”等分群标签。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>4. 结果应用与输出:</strong>
                                        <p class="mb-1 small text-muted">将分群标签结果存入Redis缓存以供快速查询，并通过API接口实时推送到淘宝直通车、拼多多推广平台的人群包中，用于精准广告投放。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>5. 监控与优化:</strong>
                                        <p class="mb-1 small text-muted">在Grafana/Kibana仪表板上监控分群准确率、覆盖率等核心指标。定期（如每周）对模型进行评估，根据效果反馈调整特征和算法参数，实现模型迭代优化。</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="card mb-4 shadow-sm">
                                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><i class="fa fa-users"></i> 用户分群结果</h6>
                                    <div>
                                        <button class="btn btn-primary btn-sm">新建分群</button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="data-table table table-striped table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>分群标签</th>
                                                    <th>用户数</th>
                                                    <th>占比</th>
                                                    <th>操作</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><span class="badge bg-success">高价值客户</span></td>
                                                    <td>1,000</td>
                                                    <td>10%</td>
                                                    <td><a href="#">查看</a> <a href="#">推送</a></td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-danger">高退货风险</span></td>
                                                    <td>500</td>
                                                    <td>5%</td>
                                                    <td><a href="#">查看</a> <a href="#">分析</a></td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-warning">潜在流失客户</span></td>
                                                    <td>800</td>
                                                    <td>8%</td>
                                                    <td><a href="#">查看</a> <a href="#">激活</a></td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-info">新品关注客户</span></td>
                                                    <td>1,200</td>
                                                    <td>12%</td>
                                                    <td><a href="#">查看</a> <a href="#">推送</a></td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-secondary">普通客户</span></td>
                                                    <td>6,500</td>
                                                    <td>65%</td>
                                                    <td><a href="#">查看</a></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card shadow-sm mb-4">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-pie-chart"></i> 用户分布</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 280px;">
                                        <canvas id="userSegmentChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="behavior-analysis" role="tabpanel" aria-labelledby="behavior-analysis-tab">
                    <h4>行为分析</h4>
                    <p class="text-muted">提取抖音/快手评论关键词（如“尺码偏小”“质量差”），生成退货原因报告。</p>

                    <!-- 功能实现细化 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light" data-bs-toggle="collapse" href="#collapse-behavior-analysis" role="button" aria-expanded="false" aria-controls="collapse-behavior-analysis">
                            <h6 class="mb-0 d-flex justify-content-between">
                                <span><i class="fa fa-cogs me-2"></i>功能实现细化</span>
                                <i class="fa fa-chevron-down toggle-icon"></i>
                            </h6>
                        </div>
                        <div class="collapse" id="collapse-behavior-analysis">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>1. 数据采集与预处理:</strong>
                                        <p class="mb-1 small text-muted">使用Scrapy或Playwright定时爬取指定竞品或自家产品的抖音、快手评论区数据。对采集到的文本进行清洗，去除无关字符和表情符号。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>2. 关键词提取与情感分析:</strong>
                                        <p class="mb-1 small text-muted">调用经过微调的中文BERT模型（基于Hugging Face Transformers）或商用NLP服务（如商汤LazyLLM），对每条评论进行关键词提取和情感倾向（正面/负面/中性）判断。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>3. 主题建模 (Topic Modeling):</strong>
                                        <p class="mb-1 small text-muted">采用LDA（Latent Dirichlet Allocation）等主题模型算法，将负面评论自动聚类成不同主题，如“尺码问题”、“产品质量”、“物流时效”、“客服态度”等。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>4. 报告生成与可视化:</strong>
                                        <p class="mb-1 small text-muted">汇总分析结果，自动生成退货原因分析报告。使用词云图展示高频负面关键词，用柱状图展示各负面主题的占比，并提供可钻取的原始评论列表。</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-cloud"></i> 退货原因词云</h6>
                                </div>
                                <div class="card-body text-center">
                                    <!-- Placeholder for word cloud -->
                                    <img src="https://via.placeholder.com/400x250.png?text=Word+Cloud+Here" alt="Word Cloud" class="img-fluid">
                                    <p class="small text-muted mt-2">关键词大小代表提及频率</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-bar-chart"></i> 负面反馈主题分布</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 250px;">
                                        <canvas id="returnReasonChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="personalized-recommendation" role="tabpanel" aria-labelledby="personalized-recommendation-tab">
                    <h4>个性化推荐</h4>
                    <p class="text-muted">基于用户画像推荐商品，降低退货率（如为易退货用户推荐更适配的尺码）。</p>

                    <!-- 功能实现细化 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light" data-bs-toggle="collapse" href="#collapse-personalized-recommendation" role="button" aria-expanded="false" aria-controls="collapse-personalized-recommendation">
                            <h6 class="mb-0 d-flex justify-content-between">
                                <span><i class="fa fa-cogs me-2"></i>功能实现细化</span>
                                <i class="fa fa-chevron-down toggle-icon"></i>
                            </h6>
                        </div>
                        <div class="collapse" id="collapse-personalized-recommendation">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>1. 融合用户与商品数据:</strong>
                                        <p class="mb-1 small text-muted">整合用户画像（分群标签、行为关键词）与商品库数据（属性、尺码表、历史退货率）。特别是将用户的退货原因（如“尺码偏小”）与商品属性关联。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>2. 混合推荐模型:</strong>
                                        <p class="mb-1 small text-muted">采用混合推荐算法。基于协同过滤推荐“相似用户喜欢”的商品，同时基于内容过滤，根据用户偏好和商品属性进行匹配。关键是加入“负向优化”：对于“高退货风险-尺码问题”的用户，主动过滤掉历史上该尺码退货率高的商品。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>3. 实时推荐服务:</strong>
                                        <p class="mb-1 small text-muted">离线计算好每个用户的Top-N推荐列表，并存入Redis。当用户访问时，从Redis快速获取推荐结果，确保低延迟。当用户产生新行为时，触发实时更新任务。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>4. A/B测试与效果追踪:</strong>
                                        <p class="mb-1 small text-muted">建立A/B测试框架，将用户分流到不同推荐策略组（如“标准推荐” vs “防退货优化推荐”）。通过仪表板监控各组的推荐转化率、客单价及最终的退货率，验证策略有效性。</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-user"></i> 用户推荐预览</h6>
                                </div>
                                <div class="card-body">
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" placeholder="输入用户ID进行预览" value="User_12345">
                                        <button class="btn btn-outline-primary" type="button">预览</button>
                                    </div>
                                    <ul class="list-group">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            推荐商品A (连衣裙)
                                            <span class="badge bg-primary rounded-pill">匹配度: 95%</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            推荐商品B (T恤)
                                            <span class="badge bg-primary rounded-pill">匹配度: 92%</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <span class="text-danger"><i class="fa fa-ban"></i> 已过滤商品C (尺码不符)</span>
                                            <span class="badge bg-secondary rounded-pill">风险高</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-line-chart"></i> 推荐策略A/B测试效果</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 250px;">
                                        <canvas id="recommendationABTestChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 竞品动态监控 -->
    <div class="card mt-4">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fa fa-binoculars me-2"></i>竞品动态监控</h5>
            <span class="status-badge status-success">运行中</span>
        </div>
        <div class="card-body">
            <p>实时抓取淘宝/拼多多竞品价格、库存、退货评价，抖音/快手热销品类，生成日报/周报。</p>
            
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="competitorTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="price-monitor-tab" data-bs-toggle="tab" data-bs-target="#price-monitor" type="button" role="tab" aria-controls="price-monitor" aria-selected="true">价格与库存监控</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="competitor-return-tab" data-bs-toggle="tab" data-bs-target="#competitor-return" type="button" role="tab" aria-controls="competitor-return" aria-selected="false">退货分析</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="competitor-report-tab" data-bs-toggle="tab" data-bs-target="#competitor-report" type="button" role="tab" aria-controls="competitor-report" aria-selected="false">报表输出</button>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content pt-3">
                <div class="tab-pane active" id="price-monitor" role="tabpanel" aria-labelledby="price-monitor-tab">
                    <h4>价格与库存监控</h4>
                    <p class="text-muted">每日更新竞品价格/库存，预警爆品缺货风险。</p>

                    <!-- 功能实现细化 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light" data-bs-toggle="collapse" href="#collapse-price-monitor" role="button" aria-expanded="false" aria-controls="collapse-price-monitor">
                            <h6 class="mb-0 d-flex justify-content-between">
                                <span><i class="fa fa-cogs me-2"></i>功能实现细化</span>
                                <i class="fa fa-chevron-down toggle-icon"></i>
                            </h6>
                        </div>
                        <div class="collapse" id="collapse-price-monitor">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>1. 监控目标配置:</strong>
                                        <p class="mb-1 small text-muted">提供界面让运营人员输入竞品的淘宝、拼多多商品链接，并设置监控频率（如每小时、每日）。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>2. 定时爬虫抓取:</strong>
                                        <p class="mb-1 small text-muted">使用Scrapy框架结合代理IP池，根据配置定时抓取竞品页面的价格、库存状态（如有）、月销量等信息。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>3. 数据存储与变更检测:</strong>
                                        <p class="mb-1 small text-muted">将抓取的数据（带时间戳）存入Elasticsearch。每次新数据入库时，与上次记录进行比对，计算价格变动，并识别库存状态变化（如从“有货”到“缺货”）。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>4. 预警与报告:</strong>
                                        <p class="mb-1 small text-muted">当价格波动超过阈值（如±5%）或爆品显示缺货时，通过企业微信/钉钉机器人发送实时预警。每日自动生成竞品价格监控日报。</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h6 class="mb-0"><i class="fa fa-table"></i> 监控列表</h6>
                            <button class="btn btn-primary btn-sm">添加监控商品</button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="data-table table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>竞品名称</th>
                                            <th>平台</th>
                                            <th>当前价格</th>
                                            <th>24h变化</th>
                                            <th>库存状态</th>
                                            <th>上次更新</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>竞品连衣裙A</td>
                                            <td><span class="badge bg-warning text-dark">淘宝</span></td>
                                            <td>¥199.00</td>
                                            <td><span class="text-success">-¥10.00</span></td>
                                            <td><span class="badge bg-success">充足</span></td>
                                            <td>5分钟前</td>
                                            <td><a href="#">图表</a> <a href="#">暂停</a></td>
                                        </tr>
                                        <tr>
                                            <td>竞品手机壳B</td>
                                            <td><span class="badge" style="background-color: #dc3545; color: white;">拼多多</span></td>
                                            <td>¥29.90</td>
                                            <td>¥0.00</td>
                                            <td><span class="badge bg-danger">缺货</span></td>
                                            <td>1小时前</td>
                                            <td><a href="#">图表</a> <a href="#">暂停</a></td>
                                        </tr>
                                        <tr>
                                            <td>竞品T恤C</td>
                                            <td><span class="badge bg-warning text-dark">淘宝</span></td>
                                            <td>¥89.00</td>
                                            <td><span class="text-danger">+¥5.00</span></td>
                                            <td><span class="badge bg-success">充足</span></td>
                                            <td>5分钟前</td>
                                            <td><a href="#">图表</a> <a href="#">暂停</a></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="competitor-return" role="tabpanel" aria-labelledby="competitor-return-tab">
                    <h4>竞品退货分析</h4>
                    <p class="text-muted">抓取竞品差评，提取退货关键词（如“尺码不准”），洞察对手弱点。</p>

                    <!-- 功能实现细化 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light" data-bs-toggle="collapse" href="#collapse-competitor-return" role="button" aria-expanded="false" aria-controls="collapse-competitor-return">
                            <h6 class="mb-0 d-flex justify-content-between">
                                <span><i class="fa fa-cogs me-2"></i>功能实现细化</span>
                                <i class="fa fa-chevron-down toggle-icon"></i>
                            </h6>
                        </div>
                        <div class="collapse" id="collapse-competitor-return">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>1. 差评数据采集:</strong>
                                        <p class="mb-1 small text-muted">配置好竞品链接后，爬虫系统将专注于抓取商品的“追评”和“差评”内容，因为这些是退货原因的高发区。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>2. 语义分析与关键词提取:</strong>
                                        <p class="mb-1 small text-muted">利用DeepSeek或微调后的BERT模型，不仅提取关键词，还分析评论的根本意图，区分是抱怨质量、尺码还是物流。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>3. 归因与聚类:</strong>
                                        <p class="mb-1 small text-muted">将提取的关键词自动归类到预设的标签下（如：质量-开线、尺码-偏大、外观-色差），并对无法自动归类的进行聚类，发现新的问题点。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>4. 竞品弱点报告:</strong>
                                        <p class="mb-1 small text-muted">系统自动汇总分析结果，生成“竞品A-连衣裙-主要退货原因为‘尺码偏小’”之类的洞察报告，为我方产品优化和营销提供依据。</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm">
                        <div class="card-header bg-white">
                            <h6 class="mb-0"><i class="fa fa-search"></i> 竞品退货原因洞察</h6>
                        </div>
                        <div class="card-body">
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" placeholder="输入竞品链接或名称...">
                                <button class="btn btn-outline-primary" type="button">分析</button>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>竞品名称</th>
                                            <th>主要退货原因</th>
                                            <th>相关评论数</th>
                                            <th>我方机会</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>竞品连衣裙A</td>
                                            <td><span class="badge bg-danger">尺码偏小</span></td>
                                            <td>152条</td>
                                            <td><span class="text-success">我方尺码更准，可强调</span></td>
                                            <td><a href="#">查看详情</a></td>
                                        </tr>
                                        <tr>
                                            <td>竞品手机壳B</td>
                                            <td><span class="badge bg-danger">材质廉价</span></td>
                                            <td>88条</td>
                                            <td><span class="text-success">我方采用液态硅胶，可对比</span></td>
                                            <td><a href="#">查看详情</a></td>
                                        </tr>
                                        <tr>
                                            <td>竞品T恤C</td>
                                            <td><span class="badge bg-danger">水洗掉色</span></td>
                                            <td>65条</td>
                                            <td><span class="text-success">我方使用固色技术，可宣传</span></td>
                                            <td><a href="#">查看详情</a></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="competitor-report" role="tabpanel" aria-labelledby="competitor-report-tab">
                    <h4>报表输出</h4>
                    <p class="text-muted">微信小程序推送竞品报告，支持PDF导出。</p>

                    <!-- 功能实现细化 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light" data-bs-toggle="collapse" href="#collapse-competitor-report" role="button" aria-expanded="false" aria-controls="collapse-competitor-report">
                            <h6 class="mb-0 d-flex justify-content-between">
                                <span><i class="fa fa-cogs me-2"></i>功能实现细化</span>
                                <i class="fa fa-chevron-down toggle-icon"></i>
                            </h6>
                        </div>
                        <div class="collapse" id="collapse-competitor-report">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>1. 报告模板配置:</strong>
                                        <p class="mb-1 small text-muted">提供可视化界面，让用户拖拽选择需要包含在报告中的模块（如价格趋势、库存预警、退货原因分析等）。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>2. 报告定时生成:</strong>
                                        <p class="mb-1 small text-muted">使用Apache Airflow或类似调度工具，设置定时任务（如每日早上9点）自动汇总前一日的竞品数据。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>3. PDF渲染与存储:</strong>
                                        <p class="mb-1 small text-muted">后端服务（Python + WeasyPrint）根据配置的模板和汇总的数据，渲染成HTML，再转换为PDF格式，并存储到对象存储（如阿里云OSS）中。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>4. 微信小程序推送:</strong>
                                        <p class="mb-1 small text-muted">调用微信服务通知API，向已订阅的用户推送报告生成提醒。用户点击提醒后，可直接在小程序内免登录查看或下载PDF报告。</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-history"></i> 最近生成的报告</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="fa fa-file-pdf-o text-danger me-2"></i>
                                                <span>竞品周报_2025-06-10.pdf</span>
                                            </div>
                                            <a href="#" class="btn btn-sm btn-outline-primary">下载</a>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="fa fa-file-pdf-o text-danger me-2"></i>
                                                <span>竞品日报_2025-06-09.pdf</span>
                                            </div>
                                            <a href="#" class="btn btn-sm btn-outline-primary">下载</a>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="fa fa-file-pdf-o text-danger me-2"></i>
                                                <span>竞品日报_2025-06-08.pdf</span>
                                            </div>
                                            <a href="#" class="btn btn-sm btn-outline-primary">下载</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-paper-plane"></i> 推送设置</h6>
                                </div>
                                <div class="card-body">
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" role="switch" id="dailyReportSwitch" checked>
                                        <label class="form-check-label" for="dailyReportSwitch">每日报告推送</label>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" role="switch" id="weeklyReportSwitch">
                                        <label class="form-check-label" for="weeklyReportSwitch">每周报告推送</label>
                                    </div>
                                    <button class="btn btn-primary">保存设置</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 营销效果预测 -->
    <div class="card mt-4">
        <div class="card-header bg-warning text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fa fa-bullseye me-2"></i>营销效果预测</h5>
            <span class="status-badge status-success">运行中</span>
        </div>
        <div class="card-body">
            <p>预测淘宝直通车、拼多多推广ROI，优化预算分配，降低非爆品推广浪费。</p>
            
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="marketingTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="roi-prediction-tab" data-bs-toggle="tab" data-bs-target="#roi-prediction" type="button" role="tab" aria-controls="roi-prediction" aria-selected="true">ROI预测</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="hot-item-tab" data-bs-toggle="tab" data-bs-target="#hot-item" type="button" role="tab" aria-controls="hot-item" aria-selected="false">爆品优先</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="budget-optimization-tab" data-bs-toggle="tab" data-bs-target="#budget-optimization" type="button" role="tab" aria-controls="budget-optimization" aria-selected="false">预算优化</button>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content pt-3">
                <div class="tab-pane active" id="roi-prediction" role="tabpanel" aria-labelledby="roi-prediction-tab">
                    <h4>ROI预测</h4>
                    <p class="text-muted">输入预算、平台、目标人群，预测转化率/销售额（准确率>85%）。</p>

                    <!-- 功能实现细化 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light" data-bs-toggle="collapse" href="#collapse-roi-prediction" role="button" aria-expanded="false" aria-controls="collapse-roi-prediction">
                            <h6 class="mb-0 d-flex justify-content-between">
                                <span><i class="fa fa-cogs me-2"></i>功能实现细化</span>
                                <i class="fa fa-chevron-down toggle-icon"></i>
                            </h6>
                        </div>
                        <div class="collapse" id="collapse-roi-prediction">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>1. 历史数据整合:</strong>
                                        <p class="mb-1 small text-muted">系统整合之前步骤中对各平台、各目标人群、各商品的ROI预测结果作为优化算法的输入。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>2. XGBoost预测模型:</strong>
                                        <p class="mb-1 small text-muted">使用XGBoost算法训练ROI预测模型。特征包括预算、投放平台、商品品类、目标人群标签、投放时段等。模型部署在阿里云PAI或本地Flask服务上。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>3. 预测服务接口:</strong>
                                        <p class="mb-1 small text-muted">提供API接口，接收前端传入的“预算”、“平台”、“目标人群”等参数，实时返回预测的转化率和销售额区间。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>4. A/B测试与模型校准:</strong>
                                        <p class="mb-1 small text-muted">提供A/B测试功能，用于比较不同广告文案或投放时段的效果。将实际投放结果回流，定期重新训练和校准模型，确保预测准确率。</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-calculator"></i> ROI预测器</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="totalBudget" class="form-label"><strong>推广平台</strong></label>
                                        <select class="form-select">
                                            <option>淘宝直通车</option>
                                            <option>拼多多推广</option>
                                            <option>抖音千川</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="totalBudget" class="form-label"><strong>日预算 (元)</strong></label>
                                        <input type="number" class="form-control" id="totalBudget" value="1000">
                                    </div>
                                    <div class="mb-3">
                                        <label for="totalBudget" class="form-label"><strong>目标人群</strong></label>
                                        <select class="form-select">
                                            <option>高价值客户</option>
                                            <option>新品关注客户</option>
                                            <option>所有用户</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-primary w-100">开始预测</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-line-chart"></i> 预测结果</h6>
                                </div>
                                <div class="card-body text-center">
                                    <h5 class="text-primary">预测ROI: 1 : 2.3</h5>
                                    <p class="text-muted">(投入1元，预计产出2.3元)</p>
                                    <hr>
                                    <p><strong>预测转化率:</strong> 5.8% (±0.5%)</p>
                                    <p><strong>预测销售额:</strong> ¥2,300 (±¥200)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="hot-item" role="tabpanel" aria-labelledby="hot-item-tab">
                    <h4>爆品优先</h4>
                    <p class="text-muted">基于抖音/快手热搜，优先推广爆品，减少非爆品浪费。</p>

                    <!-- 功能实现细化 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light" data-bs-toggle="collapse" href="#collapse-hot-item" role="button" aria-expanded="false" aria-controls="collapse-hot-item">
                            <h6 class="mb-0 d-flex justify-content-between">
                                <span><i class="fa fa-cogs me-2"></i>功能实现细化</span>
                                <i class="fa fa-chevron-down toggle-icon"></i>
                            </h6>
                        </div>
                        <div class="collapse" id="collapse-hot-item">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>1. 热搜趋势监控:</strong>
                                        <p class="mb-1 small text-muted">通过爬虫定时抓取抖音、快手、小红书等平台的热搜榜单和行业相关关键词的搜索趋势数据。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>2. 爆品潜力识别:</strong>
                                        <p class="mb-1 small text-muted">将热搜趋势与自身商品库进行匹配，结合历史销量和用户画像，识别出具有“爆品潜力”的商品，并对其进行评分。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>3. 推广策略联动:</strong>
                                        <p class="mb-1 small text-muted">系统自动将评分高的“潜力爆品”加入到ROI预测和预算优化的重点推广池中，并建议更高的预算权重。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>4. 效果追踪与反馈:</strong>
                                        <p class="mb-1 small text-muted">监控被优先推广的爆品实际的市场表现（如点击率、转化率），验证预测的准确性，并作为后续爆品识别模型优化的依据。</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm">
                        <div class="card-header bg-white">
                            <h6 class="mb-0"><i class="fa fa-fire"></i> 爆品潜力榜</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="data-table table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>商品名称</th>
                                            <th>潜力得分</th>
                                            <th>关联热搜词</th>
                                            <th>建议操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>复古风连衣裙</td>
                                            <td><span class="badge bg-danger">95分</span></td>
                                            <td>#新中式穿搭</td>
                                            <td><span class="text-success">加大直通车投入</span></td>
                                        </tr>
                                        <tr>
                                            <td>多巴胺手机壳</td>
                                            <td><span class="badge bg-warning">88分</span></td>
                                            <td>#多巴胺</td>
                                            <td><span class="text-success">增加抖音内容投放</span></td>
                                        </tr>
                                        <tr>
                                            <td>基础款白T恤</td>
                                            <td><span class="badge bg-info">75分</span></td>
                                            <td>-</td>
                                            <td><span class="text-muted">维持现有策略</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="budget-optimization" role="tabpanel" aria-labelledby="budget-optimization-tab">
                    <h4>预算优化</h4>
                    <p class="text-muted">推荐预算分配（如淘宝60%、拼多多40%），最大化整体ROI。</p>

                    <!-- 功能实现细化 -->
                    <div class="card mb-4">
                        <div class="card-header bg-light" data-bs-toggle="collapse" href="#collapse-budget-optimization" role="button" aria-expanded="false" aria-controls="collapse-budget-optimization">
                            <h6 class="mb-0 d-flex justify-content-between">
                                <span><i class="fa fa-cogs me-2"></i>功能实现细化</span>
                                <i class="fa fa-chevron-down toggle-icon"></i>
                            </h6>
                        </div>
                        <div class="collapse" id="collapse-budget-optimization">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <strong>1. 整合预测数据:</strong>
                                        <p class="mb-1 small text-muted">系统整合之前步骤中对各平台、各目标人群、各商品的ROI预测结果作为优化算法的输入。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>2. 约束规划求解:</strong>
                                        <p class="mb-1 small text-muted">基于线性规划或整数规划模型，以“最大化总ROI”为目标函数，在“总预算不超过设定值”的约束下，求解各推广渠道的最佳预算分配比例。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>3. 动态调优建议:</strong>
                                        <p class="mb-1 small text-muted">模型不仅给出初始分配，还能根据实时效果数据，建议在推广周期中动态调整预算，例如将效果不佳渠道的预算转移到高效渠道。</p>
                                    </li>
                                    <li class="list-group-item">
                                        <strong>4. 预算执行与打通:</strong>
                                        <p class="mb-1 small text-muted">（可选高级功能）通过API与各大推广平台打通，实现一键按推荐方案设置预算，并自动执行。</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-5">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-sliders"></i> 预算分配模拟</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="totalBudget" class="form-label"><strong>总推广预算 (元)</strong></label>
                                        <input type="number" class="form-control" id="totalBudget" value="50000">
                                    </div>
                                    <button class="btn btn-primary w-100">计算最优分配</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-7">
                            <div class="card shadow-sm">
                                <div class="card-header bg-white">
                                    <h6 class="mb-0"><i class="fa fa-pie-chart"></i> 推荐预算分配方案</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="height: 250px;">
                                        <canvas id="budgetAllocationChart"></canvas>
                                    </div>
                                    <p class="text-center mt-2"><strong>预期总ROI:</strong> <span class="text-success">1 : 2.8</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    if (window.userSegmentChart instanceof Chart) {
        window.userSegmentChart.destroy();
    }
    const userSegmentCtx = document.getElementById('userSegmentChart').getContext('2d');
    window.userSegmentChart = new Chart(userSegmentCtx, {
        type: 'doughnut',
        data: {
            labels: ['高价值客户', '高退货风险', '潜在流失客户', '新品关注客户', '普通客户'],
            datasets: [{
                data: [10, 5, 8, 12, 65],
                backgroundColor: ['#28a745', '#dc3545', '#ffc107', '#0dcaf0', '#6c757d']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });
</script>

<script>
    // Placeholder for return reason chart
    if (document.getElementById('returnReasonChart')) {
        if (window.returnReasonChart instanceof Chart) {
            window.returnReasonChart.destroy();
        }
        const returnReasonCtx = document.getElementById('returnReasonChart').getContext('2d');
        window.returnReasonChart = new Chart(returnReasonCtx, {
            type: 'bar',
            data: {
                labels: ['尺码问题', '产品质量', '物流时效', '描述不符', '客服态度'],
                datasets: [{
                    label: '负面反馈数',
                    data: [120, 95, 60, 45, 20],
                    backgroundColor: '#dc3545'
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
</script>

<script>
    // Placeholder for recommendation A/B test chart
    if (document.getElementById('recommendationABTestChart')) {
        if (window.recommendationABTestChart instanceof Chart) {
            window.recommendationABTestChart.destroy();
        }
        const recommendationABTestCtx = document.getElementById('recommendationABTestChart').getContext('2d');
        window.recommendationABTestChart = new Chart(recommendationABTestCtx, {
            type: 'bar',
            data: {
                labels: ['转化率', '退货率'],
                datasets: [
                    {
                        label: '策略A (标准)',
                        data: [5.5, 30],
                        backgroundColor: 'rgba(0, 82, 204, 0.7)',
                    },
                    {
                        label: '策略B (防退货优化)',
                        data: [5.2, 27],
                        backgroundColor: 'rgba(40, 167, 69, 0.7)',
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + '%'
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y + '%';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }
</script>

<script>
    // Placeholder for budget allocation chart
    if (document.getElementById('budgetAllocationChart')) {
        if (window.budgetAllocationChart instanceof Chart) {
            window.budgetAllocationChart.destroy();
        }
        const budgetAllocationCtx = document.getElementById('budgetAllocationChart').getContext('2d');
        window.budgetAllocationChart = new Chart(budgetAllocationCtx, {
            type: 'doughnut',
            data: {
                labels: ['淘宝直通车 (爆品)', '拼多多 (非爆品清仓)', '抖音千川 (拉新)'],
                datasets: [{
                    data: [60, 25, 15],
                    backgroundColor: ['#ff9500', '#d90000', '#000000']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += context.parsed + '%';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }
</script>
